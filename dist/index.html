<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/style.css">
        <title>ewayProject</title>
    </head>
    
    <!-- h1 32px -->
    <!-- h2 28px -->
    <!-- btn 18px -->
    <body>
        <div id="app" class="container wrapper">
            <div class="header">
                <!-- 白色海浪 -->
                <div class="whiteWaves">
                    <img src="./img/whiteWaves1.png" alt="whiteWaves1">
                    <img src="./img/whiteWaves2.png" alt="whiteWaves2">
                    <img src="./img/whiteWaves3.svg" alt="whiteWaves3">
                </div>
                <div class="top">

                    <!-- 標題 -->
                    <div class="top_title">
                        <h1>There is no one</h1>
                        <h2>who loves pain</h2>
                    </div>

                    <!-- 按鈕 -->
                    <div class="top_btn">
                        <button class="default btn" @click="fromMove">
                            <p>FORM</p>
                        </button>
                    </div>

                    <!-- 內文 -->
                    <div class="top_Paragraph">
                        <div class="section">
                            <div class="title">
                                <!-- 仙人掌 -->
                                <img src="./img/cactus.png" alt="cactus">
                                <p class="font18">paragraph</p>
                                <!-- 仙人掌 -->
                                <img src="./img/cactus.png" alt="cactus">
                            </div>
                            <ol class="orderList">
                                <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
                            </ol>
                        </div>

                        <div class="section">
                            <div class="title">
                                <!-- 仙人掌 -->
                                <img src="./img/cactus.png" alt="cactus">
                                <p class="font18">paragraph</p>
                                <!-- 仙人掌 -->
                                <img src="./img/cactus.png" alt="cactus">
                            </div>
                            <ol class="orderList">
                                <li>Quisque sodales leo <span>vitae vulputate auctor.</span></li>
                                <li>Proin ac justo ut nisl tincidunt imperdiet.Maecenas viverra libero a
                                    pellentesque blandit.</li>
                                <li>Cras tristique tellus id leo bibendum, eu dapibus nisl accumsan.</li>
                                <li>Donec ultrices sapien <span>vitae leo venenatis ullamcorper.</span></li>
                            </ol>
                        </div>

                        <!-- 獨木舟 & 泡泡 -->
                        <div class="supBubble">
                            <img src="./img/sup.svg" alt="sup">
                            <img src="./img/Bubble.png" alt="Bubble">
                            <img src="./img/Bubble.png" alt="Bubble">
                            <img src="./img/paddle.png" alt="paddle">
                        </div>

                        <!-- 獨木舟 & 煙火 -->
                        <div class="supFireworks">
                            <img src="./img/sup.png" alt="sup">
                            <img src="./img/fireworks.svg" alt="Fireworks">
                            <img src="./img/paddle.png" alt="paddle">
                        </div>
                    </div>

                </div>
                <div class="theWavesContainer">
                    <div class="theWaves"></div>
                </div>
            </div>

            <article class="main wrapper">

                <!-- 表單 -->
                <div id="from" style='margin-top:-100px; padding-top:100px'></div>
                <div class="form">
                    <div class="title">
                        <p>FORM</p>
                        <img src="./img/turtle.png" alt="turtle">
                    </div>
                    <div class="formCotent">
                        <div class="formList">
                            <label for="store">store</label>
                            <img src="./img/dropDown.png" alt="dropDown">
                            <input
                                id="store"
                                type="text"
                                class="fromItem"
                                list="storelist"
                                placeholder="placeholder text"
                                v-model="inputData.selectedStore"
                                @blur="checkOptions($event)"
                                required
                            >
                            <!-- 必填及無搜尋結果提示訊息 -->
                            <span class="error_Msg required none">required</span>
                            <span class="error_Msg noResult none">no result</span>
                            <datalist   
                                id="storelist" 
                                class="chooseItem"
                            >
                                <option value="store1">
                                <option value="store2">
                                <option value="store3">
                            </datalist>
                        </div>

                        <div class="formList">
                            <label for="fromName">name</label>
                            <input
                                type="text"
                                id="fromName"
                                class="fromItem"
                                placeholder="placeholder text"
                                v-model.trim="inputData.name" 
                                @keydown="unNumber($event)"
                                @input="checkName($event)"
                                @stop
                                required
                            />
                            <!-- 必填提示 -->
                            <span class="error_Msg none">required</span>
                            <!-- 錯誤提示 -->
                            <span class="error_Msg none">wrong format</span>
                        </div>

                        <!-- compalate -->
                        <!-- 手機格式 -->
                        <!-- 數字 -->
                        <!-- 10位數 -->
                        <!-- 必填 -->
                        <div class="formList">
                            <label for="fromPhone">phone</label>
                            <input
                                type="number" 
                                inputmode="numeric" 
                                pattern="[0-9]*"
                                step="1"
                                id="fromPhone"
                                class="fromItem"
                                placeholder="placeholder text"
                                v-model.trim="inputData.phone"
                                maxlength="10"
                                required
                                @input="checkPhone($event)"
                                />
                                <!-- 必填提示 -->
                                <span class="error_Msg none">required</span>
                                <!-- 錯誤提示 -->
                                <span class="error_Msg none">wrong format</span>
                        </div>


                        <!-- compalate -->
                        <!-- 數字 -->
                        <!-- 大於0 -->
                        <!-- 必填 -->
                        <div class="formList">
                            <label for="fromAmount">Amount of consumption</label>
                            <input
                                type="number" 
                                inputmode="numeric" 
                                pattern="[0-9]*"
                                step="1"
                                id="fromAmount"
                                class="fromItem"
                                placeholder="placeholder text"
                                v-model.trim="inputData.amount"
                                @input="checkAmount($event)"
                                required
                            />
                            <!-- 必填提示 -->
                            <span class="error_Msg none">required</span>
                            <!-- 錯誤提示 -->
                            <span class="error_Msg none">wrong format</span>
                        </div>
                        

                        <!-- 必填 -->
                        <div class="formList">
                            <label for="fromPayment">payment</label>
                            <img src="./img/dropDown.png" alt="dropDown">
                            <select 
                                id="fromPayment"
                                class="fromItem"
                                v-model="inputData.payment" 
                                @input="checkPayment($event)"
                            >
                                <option value="digital payment" selected>digital payment</option>
                                <option value="ATM">ATM</option>
                            </select>

                            <!-- 必填提示 -->
                            <span class="error_Msg none">required</span>
                            <!-- 錯誤提示 -->
                            <span class="error_Msg none">wrong format</span>
                        </div>
                    </div>
                </div>

                <!-- 預設按鈕 -->
                <div class="main_btn" id="submit">
                    <button 
                            class="default"
                            @click="submitForm()"
                            >
                        <p>submit</p>
                    </button>
                </div>

                <!-- 成功按鈕 -->
                <div class="main_btn none" id="success">
                    <button 
                            class="success" 
                            @click="submitForm()">
                        <img src="./img/success.png" alt="success">
                        <p>success</p>
                    </button>
                </div>

                <!-- 失敗按鈕 -->
                <div class="main_btn none" id="failure">
                    <button 
                            class="failure"
                            @click="submitForm()">
                        <img src="./img/failure.svg" alt="success">
                        <p>failure</p>
                    </button>
                    <p>This person does not exist</p>
                </div>

                

                <!-- 抽獎區 -->
                <div class="raffleArea">
                    <ul class="raffleBlock">
                        
                        <!-- TOP 3 -->
                        <template 
                            v-for="item in raffleDataA"
                            :key="item.id"
                        >
                            <li class="raffleItem">
                                <div class="certificate_ID typeA">
                                    <p>{{item.id}}</p>
                                </div>
                                <p class="raffleName font18">{{item.name}}</p>
                                <div class="mark">
                                    <p>{{item.mark}}</p>
                                </div>
                            </li>
                        </template>

                        <!-- 第三名以後 -->
                        <template 
                            v-for="item in raffleDataB"
                            :key="item.id"
                        >
                            <li class="raffleItem">
                                <div class="certificate_ID typeB">
                                    <p style="padding-bottom: 2px;">{{item.id}}</p>
                                </div>
                                <p class="raffleName" style="color: #A0BCC8">{{item.name}}</p>
                                <div class="mark" style="border: 1px solid #A0BCC8">
                                    <p style="color: #A0BCC8">{{item.mark}}</p>
                                </div>
                            </li>
                        </template>

                    </ul>
                </div>

                <!-- lighthouse -->
                <div class="lighthouse_wrap">
                    <div class="title">
                        <img src="./img/leftLine.png" alt="leftLine">
                        <div class="content">
                            <h6>13.32</h6>
                            <h6>who seeks after it and<br>wants to have it</h6>
                        </div>
                        <img src="./img/rightLine.png" alt="rightLine">
                    </div>
                    <img src="./img/lighthouse.svg" alt="lighthouse">
                </div>
            </article>

            <!-- 商城 -->
            <footer class="shopMall_wrap">
                <h6>Neque porro quisquam<br>est qui dolorem!</h6>
                <img src="./img/market.svg" alt="market">
            </footer>

        </div>

        <script src="./js/vender/Vue/vue.global.js"></script>
        <script src="./js/vender/isJS/is.min.js"></script>
        <script>
        
            const app = Vue.createApp({
                data() {
                    return {

                        // TOP3
                        raffleDataA: [
                            {
                                id: "A",
                                mark: "ONE",
                                name: "dehumidifier"
                            },
                            {
                                id: "B",
                                mark: "ONE",
                                name: "range hood"
                            },
                            {
                                id: "C",
                                mark: "ONE",
                                name: "vacuum cleaner"
                            }
                        ],

                        // 第三名以後
                        raffleDataB: [
                            {
                                id: "D",
                                mark: "ONE",
                                name: "toaster"
                            },
                            {
                                id: "E",
                                mark: "ONE",
                                name: "scale"
                            },
                            {
                                id: "F",
                                mark: "ONE",
                                name: "straightening iron"
                            },
                            {
                                id: "G",
                                mark: "FIVE",
                                name: "vacuum cleaner"
                            },
                            {
                                id: "H",
                                mark: "TEN",
                                name: "rice cooker"
                            }
                        ],
                        
                        // 使用者輸入的 Data
                        inputData: {
                            selectedStore: "",
                            name: "",
                            phone: "",
                            amount: "",
                            payment:"digital payment"
                        },

                        // 表單驗證的 Data
                        submitData: {
                            selectedStore: false,
                            name: false,
                            phone: false,
                            amount: false,
                            payment: true
                        }
                    }
                },
                methods: {

                    // from錨點
                    fromMove(){
                        let target = document.getElementById('from');
                        const formPosition = target.getBoundingClientRect().top + window.pageYOffset;
                        window.scrollTo({
                            top: formPosition,
                            behavior: 'smooth'
                        })
                    },
                    // ========== 驗證格式 ========== // 
                    // 封装nameRule方法
                    nameRule(nameStr){
                        let nameRule =  new RegExp('^[\u4e00-\u9fa5]+$|^[a-zA-Z\s]+$');
                        return nameRule.test(nameStr);
                    },
                    // 封装phoneRule方法
                    phoneRule(str){
                        let phoneRule =  new RegExp("^09\\d{8}$");
                        return phoneRule.test(str);
                    },
                    // 封装amountRule方法
                    amountRule(number){
                        let amountRule =  new RegExp("/[0-9]|\.|Backspace|Tab|ArrowRight|ArrowLeft|Delete/");
                        return amountRule.test(number);
                    },
                    // 封装correctAnswer方法
                    correctAnswer(input, required, noResult) {
                        input.classList.remove('error');
                        required.classList.add('none');
                        noResult.classList.add('none');
                    },
                    // 封装showError方法
                    showError(input, required, noResult) {
                        input.classList.add('error');
                        required.classList.add('none');
                        noResult.classList.remove('none');
                    },
                    // 封装noResult方法
                    showRequired(input, required, noResult) {
                        input.classList.add('error');
                        required.classList.remove('none');
                        noResult.classList.add('none');
                    },

                    // 1、store 格式驗證
                    checkOptions(e){
                        // 取得輸入欄位及相關元素
                        const input = e.target;
                        const required = input.nextElementSibling; // 提高可讀性
                        const noResult = required.nextElementSibling; // 提高可讀性
                        const value = input.value.trim();
                        const dataList = document.getElementById(input.getAttribute('list')); // 提高複用性
                        const options = Array.from(dataList.options).map(o => o.value); // 將 dataList.options 這個類陣列轉化為 陣列，並提取 datalist value 存放到新的陣列

                        if (value === '') {
                            // 輸入為空值時顯示 required 訊息
                            this.showRequired(input, required, noResult);
                            this.submitData.selectedStore = false;
                        } else if (options.includes(value)) {
                            // 輸入值符合選項時移除錯誤提示
                            this.correctAnswer(input, required, noResult);
                            this.submitData.selectedStore = true;
                        } else {
                            // 輸入值不符合選項時顯示 noResult 訊息
                            this.showError(input, required, noResult);
                            this.submitData.selectedStore = false;
                        }
                    },


                    // 2、name 格式驗證
                    unNumber(e) {
                        const input = e.target;
                        const required = input.nextElementSibling;
                        const noResult = required.nextElementSibling;
                        if (
                            (e.which >= 48 && e.which <= 57) ||
                            (e.which > 8 && e.which <= 9) ||
                            (e.which >= 96 && e.which < 105)
                        ) {
                            this.showError(input, required, noResult);
                            this.submitData.name = false;
                        }
                    },
                    checkName(e) {
                        const input = e.target;
                        const required = input.nextElementSibling;
                        const noResult = required.nextElementSibling;
                        const value = input.value.trim();

                        // 輸入為空值時顯示 required 訊息
                        if (value === '') {
                            this.showRequired(input, required, noResult);
                            this.submitData.name = false;
                            return;
                        }
                        // 輸入值符合選項時移除錯誤提示
                        if (this.nameRule(value)) {
                            this.correctAnswer(input, required, noResult);
                            this.submitData.name = true;
                        }
                    },

                    // 3、phone 格式驗證
                    checkPhone(e){
                        const input = e.target;
                        const required = input.nextElementSibling;
                        const noResult = required.nextElementSibling;
                        const value = input.value.trim();

                        // 輸入為空值時顯示 required 訊息
                        if(value === ""){
                            this.showRequired(input, required, noResult)
                            this.submitData.phone = false;
                            return;
                        }
                        // 字數少於10錯誤
                        if( value.length < 10){
                            this.showError(input, required, noResult)
                            this.submitData.phone = false;
                            return;
                        }
                        // 輸入值不符合選項時顯示 noResult 訊息
                        if(!this.phoneRule(value)){
                            this.showError(input, required, noResult);
                            this.submitData.phone = false;
                            return;
                        }else{
                            // 輸入值符合選項時移除錯誤提示
                            this.correctAnswer(input, required, noResult);
                            this.submitData.phone = true;
                        }
                        
                    },

                    checkAmount(e) {
                        const input = e.target;
                        const required = input.nextElementSibling;
                        const noResult = required.nextElementSibling;
                        const value = input.value.trim();
                        const minAmount = 0;
                        const isValidAmount = value !== '' && value >= minAmount;
                        
                        // 不等於空值 或 等於 0 錯誤
                        if(isValidAmount){
                            this.correctAnswer(input, required, noResult);
                            this.submitData.amount = true;
                        }else{
                            // 驗證通過
                            this.showRequired(input, required, noResult);
                            this.submitData.amount = false;
                        }
                    },

                    // 5、payment 格式驗證
                    checkPayment(e){
                        const input = e.target;
                        const required = input.nextElementSibling;
                        const noResult = required.nextElementSibling;
                        const value = input.value.trim();

                        // 判斷是否選擇了有效選項（防呆）
                        const validOptions = ['digital payment', 'ATM'];
                        const isValid = validOptions.includes(value);

                        // 雖然現在是 checked，但萬一未來html改成非 checked，js仍然可複用
                        if (isValid) {
                            this.correctAnswer(input, required, noResult);
                            this.submitData.payment = true;
                        } else {
                            this.showRequired(input, required, noResult);
                            this.submitData.payment = false;
                        }
                    },

                    submitForm() {
                        const isValid = this.checkFormValidity();
                        this.updateFormStatus(isValid);
                    },
                    checkFormValidity() {
                    // 如果每個欄位都有效，返回true，否則返回false
                        return (
                        this.submitData.selectedStore &&
                        this.submitData.name &&
                        this.submitData.phone &&
                        this.submitData.amount &&
                        this.submitData.payment
                        );
                    },
                    updateFormStatus(isValid) {
                        const submit = document.getElementById('submit');
                        const success = document.getElementById('success');
                        const failure = document.getElementById('failure');
                        if (isValid) {
                            // 如果表單有效，則顯示成功消息，並隱藏提交按鈕和失敗消息
                            success.classList.remove('none');
                            submit.classList.add('none');
                            failure.classList.add('none');
                            // console.log("驗證通過");
                        } else {
                            // 如果表單無效，則顯示失敗消息，並隱藏提交按鈕和成功消息
                            submit.classList.add('none');
                            success.classList.add('none');
                            failure.classList.remove('none');
                            // console.log("驗證未通過");
                        }
                    },
                },

            });
            const vm = app.mount("#app");
        </script>
    </body>
</html>